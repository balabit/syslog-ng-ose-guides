<?xml version="1.0" encoding="UTF-8"?>

<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="procedure-configuring-tls-server" oldrole="procedure">
<h1 name="procedure-configuring-tls-server" version="5.0" xmlns="http://docbook.org/ns/docbook">Configuring TLS on the syslog-ng server</h1>
<h6 oldrole="formalpara">Purpose:</h6>

<p oldrole="para">Complete the following steps on the syslog-ng server:</p>
<h6 oldrole="formalpara">Steps:</h6>

<ol oldrole="procedure"><li oldrole="step">
<p oldrole="para">Create an X.509 certificate for the syslog-ng server.</p>
<madcap:snippetblock src="../../shared/wnt/note-cert-common-name.htm"></madcap:snippetblock>
</li><li oldrole="step">
<p oldrole="para">Copy the certificate (for example <span class="Code" oldrole="filename">syslog-ng.cert</span>) of the syslog-ng server to the syslog-ng server host, for example into the <span class="Code" oldrole="filename">/opt/syslog-ng/etc/syslog-ng/cert.d</span> directory. The certificate must be a valid X.509 certificate in PEM format.</p>
</li><li oldrole="step">
<p oldrole="para">Copy the private key (for example <span class="Code" oldrole="filename">syslog-ng.key</span>) matching the certificate of the syslog-ng server to the syslog-ng server host, for example into the <span class="Code" oldrole="filename">/opt/syslog-ng/etc/syslog-ng/key.d</span> directory. The key must be in PEM format. If you want to use a password-protected key, see <MadCap:xref href="chapter-encrypted-transport-tls.htm#tls-password-protected-keys"></MadCap:xref>.</p>
</li><li oldrole="step">
<p oldrole="para">Add a source statement to the syslog-ng configuration file that uses the <span class="Code" oldrole="userinput">tls( key-file(key_file_fullpathname) cert-file(cert_file_fullpathname) )</span> option and specify the key and certificate files. The source must use the source driver (<span class="Code" oldrole="parameter">network()</span> or <span class="Code" oldrole="parameter">syslog()</span>) matching the destination driver used by the syslog-ng client.</p>

<h6 oldrole="example">Example: A source statement using TLS</h6>
<p oldrole="para">The following source receives log messages encrypted using TLS, arriving to the <span class="Code" oldrole="userinput">1999/TCP</span> port of any interface of the syslog-ng server.</p>
<pre class="Code" oldrole="synopsis">source demo_tls_source {
    network(ip(0.0.0.0) port(1999)
        transport("tls")
               tls( key-file("/opt/syslog-ng/etc/syslog-ng/key.d/syslog-ng.key")
             cert-file("/opt/syslog-ng/etc/syslog-ng/cert.d/syslog-ng.cert"))
    );
};</pre>
<p oldrole="para">A similar source for receiving messages using the IETF-syslog protocol:</p>
<pre class="Code" oldrole="synopsis">source demo_tls_syslog_source {
                    syslog(ip(0.0.0.0) port(1999)
                    transport("tls")
                    tls( key-file("/opt/syslog-ng/etc/syslog-ng/key.d/syslog-ng.key")
             cert-file("/opt/syslog-ng/etc/syslog-ng/cert.d/syslog-ng.cert"))
    );
};</pre>

</li><li oldrole="step">
<p oldrole="para">Disable mutual authentication for the source by setting the following TLS option in the source statement: <span class="Code" oldrole="userinput">tls( peer-verify(optional-untrusted);</span></p>
<p oldrole="para">If you want to authenticate the clients, you have to configure mutual authentication. For details, see <MadCap:xref href="chapter-encrypted-transport-tls.htm#tls-mutualauth"></MadCap:xref>.</p>
<p oldrole="para">For the details of the available <span class="Code" oldrole="parameter">tls()</span> options, see <MadCap:xref href="chapter-encrypted-transport-tls.htm#tlsoptions"></MadCap:xref>.</p>

<h6 oldrole="example">Example: Disabling mutual authentication</h6>
<p oldrole="para">The following source receives log messages encrypted using TLS, arriving to the <span class="Code" oldrole="userinput">1999/TCP</span> port of any interface of the syslog-ng server. The identity of the syslog-ng client is not verified.</p>
<pre class="Code" oldrole="synopsis">source demo_tls_source {
    network(ip(0.0.0.0) port(1999)
        transport("tls")
               tls( key-file("/opt/syslog-ng/etc/syslog-ng/key.d/syslog-ng.key")
                    cert-file("/opt/syslog-ng/etc/syslog-ng/cert.d/syslog-ng.cert")
             peer-verify(optional-untrusted))
    );
};</pre>
<p oldrole="para">A similar source for receiving messages using the IETF-syslog protocol:</p>
<pre class="Code" oldrole="synopsis">source demo_tls_syslog_source {
                        syslog(ip(0.0.0.0) port(1999)
                        transport("tls")
                        tls( key-file("/opt/syslog-ng/etc/syslog-ng/key.d/syslog-ng.key")
                        cert-file("/opt/syslog-ng/etc/syslog-ng/cert.d/syslog-ng.cert")
             peer-verify(optional-untrusted))
    );
};</pre>

<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">Do not forget to update the certificate and key files when they expire.</p></td></tr></tbody></table>
</li></ol></body></html>
