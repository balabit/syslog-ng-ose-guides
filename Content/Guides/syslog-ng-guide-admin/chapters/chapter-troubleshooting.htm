<?xml version="1.0" encoding="UTF-8"?>

<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="chapter-troubleshooting-syslog-ng" oldrole="chapter">
<h1 name="chapter-troubleshooting-syslog-ng" version="5.0">Troubleshooting syslog-ng</h1>
<MadCap:keyword term="troubleshooting"></MadCap:keyword>
<MadCap:keyword term="error solving"></MadCap:keyword>
<MadCap:keyword term="syslog-ng:['troubleshooting']"></MadCap:keyword>
<p oldrole="para">This chapter provides tips and guidelines about troubleshooting problems related to syslog-ng.<MadCap:conditionaltext MadCap:conditions="pe"> Troubleshooting the <MadCap:variable name="General.agent"></MadCap:variable> application is discussed in <a href="https://support.oneidentity.com/technical-documents/one-identity-psm/syslog-ng-windows-agent-guide-admin/chapter-windows-troubleshooting" oldrole="olink"></a>.</MadCap:conditionaltext></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">As a general rule, first try to get logging the messages to a local file. Once this is working, you know that syslog-ng is running correctly and receiving messages, and you can proceed to forwarding the messages to the server.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">Always check the configuration files for any syntax errors on both the client and the server using the <b oldrole="command">syslog-ng --syntax-only</b> command.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">If the <MadCap:variable name="General.abbrev"></MadCap:variable> server does not receive the messages, verify that the IP addresses and ports are correct in your sources and destinations. Also, check that the client and the server uses the same protocol (a common error is to send logs on UDP, but configure the server to receive logs on TCP.</p>
<p oldrole="para">If the problem persist, use <b oldrole="command">tcpdump</b> or a similar packet sniffer tool on the client to verify that the messages are sent correctly, and on the server to verify that it receives the messages.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">To find message-routing problems, run <MadCap:variable name="General.abbrev"></MadCap:variable> with the following command <b oldrole="command">syslog-ng -Fevd</b>. That way <MadCap:variable name="General.abbrev"></MadCap:variable> will run in the foreground, and display debug messages about the messages that are processed.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">If syslog-ng is closing the connections for no apparent reason, be sure to check the log messages of syslog-ng. You might also want to run syslog-ng with the <span class="Code" oldrole="parameter">--verbose</span> or <span class="Code" oldrole="parameter">--debug</span> command-line options for more-detailed log messages. You can enable these messages without restarting syslog-ng using the <b oldrole="command">syslog-ng-ctl verbose --set=on</b> command. For details, see the syslog-ng-ctl man page at <MadCap:xref href="#syslog-ng-ctl.1"></MadCap:xref>.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">Build up encrypted connections step-by-step: first create a working unencrypted (for example TCP) connection, then add TLS encryption, and finally client authentication if needed.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">If you use the same driver and options in the destination of your <MadCap:variable name="General.abbrev"></MadCap:variable> client and the source of your <MadCap:variable name="General.abbrev"></MadCap:variable> server, everything should work as expected. Unfortunately there are some other combinations, that seem to be working, but result in losing parts of the messages. For details on the working combinations, see <MadCap:xref href="concepts-things-to-consider.htm#concepts-things-to-consider"></MadCap:xref>.</p>
</li>
</ul>
<h2 name="concepts-losing-messages">Possible causes of losing log messages</h2>
<MadCap:keyword term="losing messages"></MadCap:keyword>
<MadCap:keyword term="message loss"></MadCap:keyword>
<p oldrole="para">During the course of a message from the sending application to the final destination of the message, there are a number of locations where a message may be lost, even though syslog-ng does its best to avoid message loss. Usually losing messages can be avoided with careful planning and proper configuration of syslog-ng and the hosts running syslog-ng. The following list shows the possible locations where messages may be lost, and provides methods to minimize the risk of losing messages.</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">Between the application and the syslog-ng client</i>: Make sure to use an appropriate source to receive the logs from the application (for example from <span class="Code" oldrole="filename">/dev/log</span>). For example, use <span class="Code" oldrole="parameter">unix-stream</span> instead of <span class="Code" oldrole="parameter">unix-dgram</span> whenever possible.</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">When syslog-ng is sending messages</i>: If syslog-ng cannot send messages to the destination and the output buffer gets full, syslog-ng will drop messages.</p>
<p oldrole="para">Use flags (flow-control) to avoid it (for details, see <MadCap:xref href="configuring-flow-control.htm#configuring-flow-control"></MadCap:xref>). For more information about the error caused by the missing flow-control, see <MadCap:xref href="message-missing-flow-control.htm#message-missing-flow-control"></MadCap:xref>.</p>
<p oldrole="para">The number of dropped messages is displayed per destination in the log message statistics of syslog-ng (for details, see <MadCap:xref href="chapter-log-statistics.htm#chapter-log-statistics"></MadCap:xref>).</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">On the network</i>: When transferring messages using the UDP protocol, messages may be lost without any notice or feedback <MadCap:variable name="General.mdash"></MadCap:variable> such is the nature of the UDP protocol. Always use the TCP protocol to transfer messages over the network whenever possible.</p>
<p condition="pe" oldrole="para">For details on minimizing message loss when using UDP, see the following tutorial:<a href="https://support.oneidentity.com/technical-documents/one-identity-psm/syslog-ng-tutorial-udp-source" oldrole="olink"></a>.</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">In the socket receive buffer</i>: When transferring messages using the UDP protocol, the UDP datagram (that is, the message) that reaches the receiving host placed in a memory area called the <span class="Code" oldrole="userinput">socket receive buffer</span>. If the host receives more messages than it can process, this area overflows, and the kernel drops messages without letting syslog-ng know about it. Using TCP instead of UDP prevents this issue. If you must use the UDP protocol, increase the size of the receive buffer using the <span class="Code" oldrole="parameter">so-rcvbuf()</span> option.</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">When syslog-ng is receiving messages</i>:</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The receiving syslog-ng (for example the syslog-ng server or relay) may drop messages if the fifo of the destination file gets full. The number of dropped messages is displayed per destination in the log message statistics of syslog-ng (for details, see <MadCap:xref href="chapter-log-statistics.htm#chapter-log-statistics"></MadCap:xref>).</p>
</li>
<li condition="pe" oldrole="listitem">
<MadCap:snippetBlock src="../../shared/chunk/pe-para-license-limit.htm"></MadCap:snippetBlock>
</li>
</ul>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">When the destination cannot handle large load</i>: When syslog-ng is sending messages at a high rate into an SQL database, a file, or another destination, it is possible that the destination cannot handle the load, and processes the messages slowly. As a result, the buffers of syslog-ng fill up, syslog-ng cannot process the incoming messages, and starts to loose messages. For details, see the previous entry. Use the <span class="Code" oldrole="parameter">throttle</span> parameter to avoid this problem.</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">As a result of an unclean shutdown of the syslog-ng server</i>: If the host running the syslog-ng server experiences an unclean shutdown, it takes time until the clients realize that the connection to the syslog-ng server is down. Messages that are put into the output TCP buffer of the clients during this period are not sent to the server.</p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">When <MadCap:variable name="General.abbrev"></MadCap:variable> is writing messages into files</i>: If <MadCap:variable name="General.abbrev"></MadCap:variable> receives a signal (SIG) while writing log messages to file, the log message that is processed by the <i oldrole="emphasis">write</i> call can be lost if the <span class="Code" oldrole="parameter">flush_lines</span> parameter is higher than 1.</p>
</li>
</ul>
<MadCap:snippetBlock src="syslog-ng-core-files.htm"></MadCap:snippetBlock>
<h2 name="syslog-ng-strace-truss-tusc">Collecting debugging information with strace, truss, or tusc</h2>
<MadCap:keyword term="troubleshooting:['truss']"></MadCap:keyword>
<MadCap:keyword term="troubleshooting:['strace']"></MadCap:keyword>
<MadCap:keyword term="troubleshooting:['tusc']"></MadCap:keyword>
<MadCap:keyword term="truss"></MadCap:keyword>
<MadCap:keyword term="strace"></MadCap:keyword>
<MadCap:keyword term="tusc"></MadCap:keyword>
<p oldrole="para">To properly troubleshoot certain situations, it can be useful to trace which system calls <MadCap:variable name="General.abbrev"></MadCap:variable> performs. How this is performed depends on the platform running <MadCap:variable name="General.abbrev"></MadCap:variable>. In general, note the following points:</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">When <MadCap:variable name="General.abbrev"></MadCap:variable> is started, a supervisor process might stay in the foreground, while the actual syslog-ng daemon goes to the background. Always trace the background process.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">Apart from the system calls, the time between two system calls can be important as well. Make sure that your tracing tool records the time information as well. For details on how to do that, refer to the manual page of your specific tool (for example, <b oldrole="command">strace</b> on Linux, or <b oldrole="command">truss</b> on Solaris and BSD).</p>
</li>
<li oldrole="listitem">
<p oldrole="para">Run your tracing tool in verbose mode, and if possible, set it to print long output strings, so the messages are not truncated.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">When using <b oldrole="command">strace</b>, also record the output of <b oldrole="command">lsof</b> to see which files are accessed.</p>
</li>
</ul>
<p oldrole="para">The following are examples for tracing system calls of syslog-ng on some platforms. The output is saved into the <span class="Code" oldrole="filename">/tmp/syslog-ng-trace.txt</span> file, sufficed with the PID of the related syslog-ng process.The path of the syslog-ng binary may be different for your installation, as distribution-specific packages may use different paths.</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">Linux</i>: <b oldrole="command"> strace -o /tmp/trace.txt -s256 -ff -ttT /opt/syslog-ng/sbin/syslog-ng -f /opt/syslog-ng/etc/syslog-ng.conf -Fdv</b></p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">HP-UX</i>: <b oldrole="command">tusc -f -o /tmp/syslog-ng-trace.txt -T /opt/syslog-ng/sbin/syslog-ng</b></p>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">IBM AIX and Solaris</i>: <b oldrole="command">truss -f -o /tmp/syslog-ng-trace.txt -r all -w all -u libc:: /opt/syslog-ng/sbin/syslog-ng -d -d -d</b></p>
</li>
</ul>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="tip" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">TIP: </span><p oldrole="para">To execute these commands on an already running <MadCap:variable name="General.abbrev"></MadCap:variable> process, use the <span class="Code" oldrole="userinput">-p &lt;pid_of_syslog-ng&gt;</span> parameter.</p></td></tr></tbody></table>
<MadCap:snippetBlock src="syslog-ng-failure-script.htm"></MadCap:snippetBlock>
<h2 name="syslog-ng-stop">Stopping syslog-ng</h2>
<p oldrole="para">To avoid problems, always use the init scripts to stop syslog-ng (<b oldrole="command">/etc/init.d/syslog-ng stop</b>), instead of using the <b oldrole="command">kill</b> command. This is especially true on Solaris and HP-UX systems, here use <b oldrole="command">/etc/init.d/syslog stop</b>.</p>
<h2 name="report-bugs">Reporting bugs and finding help</h2>
<p oldrole="para">If you need help, want to open a support ticket, or report a bug, we recommend using the <b oldrole="command">syslog-ng-debun</b> tool to collect information about your environment and <MadCap:variable name="General.abbrev"></MadCap:variable> version. For details, see <MadCap:xref href="#syslog-ng-debun.1"></MadCap:xref>. For support contacts, see <MadCap:xref href="common-preface-contact-support.htm#common-preface-contact-support"></MadCap:xref>.</p>
<h2 name="diskbuffer-recovery">Recover data from orphaned diskbuffer files</h2>
<p oldrole="para">When you change the configuration of a <MadCap:variable name="General.abbrev"></MadCap:variable> host that uses disk-based buffering (also called disk queue), <MadCap:variable name="General.abbrev"></MadCap:variable> may start new disk buffer files for the destinations that you have changed. In such case, <MadCap:variable name="General.abbrev"></MadCap:variable> abandons the old disk queue files. If there were unsent log messages in the disk queue files, these messages remain in the disk queue files, and will not be sent to the destinations.</p>
<!--
        <para>To find, examine, and flush the log messages from such orphaned disk queue files, see the <olink targetdoc="syslog-ng-tutorial-diskbuffer-recovery"/> tutorial.</para>
-->
<MadCap:snippetBlock src="../../shared/chunk/topic-troubelshooting-unusual-directory.htm"></MadCap:snippetBlock>
<MadCap:snippetBlock src="../../shared/chunk/topic-troubelshooting-unusual-port-number.htm"></MadCap:snippetBlock>
<h2 name="error-messages">Error messages</h2>
<MadCap:snippetBlock src="message-missing-flow-control.htm"></MadCap:snippetBlock>
<MadCap:snippetBlock src="message-alert-unknown-ca.htm"></MadCap:snippetBlock>
<MadCap:snippetBlock src="message-tls-eol-character.htm"></MadCap:snippetBlock>
</body></html>
