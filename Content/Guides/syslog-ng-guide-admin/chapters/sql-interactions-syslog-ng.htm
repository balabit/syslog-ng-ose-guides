<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <meta name="description" content="" />
    </head>
    <body name="sql-interactions-syslog-ng" oldrole="section">
        <h1 name="sql-interactions-syslog-ng">The way syslog-ng interacts with the database</h1>
        <h6 oldrole="formalpara">Used SQL operations by syslog-ng</h6>
        <p oldrole="para"><i oldrole="emphasis">Create table:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">If the given table does not exist, syslog-ng tries to create it with the given column types.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application automatically creates the required tables and columns, if the user account used to connect to the database has the required privileges.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">If syslog-ng cannot create or alter a table, it tries to do it again when it reaches the next <span class="Code" oldrole="parameter">time-reopen()</span>.</p>
            </li>
        </ul>
        <p oldrole="para"><i oldrole="emphasis">Alter table:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">If the table structure is different from given structure in an existing table, syslog-ng tries to add columns in this table but never will delete or modify an existing column.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">If <MadCap:variable name="General.abbrev"></MadCap:variable> cannot create or alter a table, it tries to do it again when reach the next <span class="Code" oldrole="parameter">time-reopen()</span>.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application requires read and write access to the SQL table, otherwise it cannot verify that the destination table exists.</p>
            </li>
        </ul>
        <p oldrole="para"><i oldrole="emphasis">Insert table:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">Insert new records in a table.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">Inserting the records into the database is performed by a separate thread.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application automatically performs the escaping required to insert the messages into the database.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">If insert returns with error, syslog-ng tries to insert the message +two times by default, then drops it. Retrying time is the value of <span class="Code" oldrole="parameter">time-reopen()</span>.</p>
            </li>
        </ul>
        <h6 oldrole="formalpara">Encoding</h6>
        <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application uses UTF-8 by default when writes logs into database.</p>
        <h6 oldrole="formalpara">Start/stop and reload</h6>
        <p oldrole="para"><i oldrole="emphasis">Start:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application will connect to database automatically after starting regardless existing incoming messages.</p>
            </li>
        </ul>
        <p oldrole="para"><i oldrole="emphasis">Stop:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application will close the connection to database before shutting down.</p>
            </li>
        </ul>
        <p oldrole="para"><i oldrole="emphasis">Possibility of losing logs:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application cannot lose logs during shutting down if disk buffer was given and it is not full yet.</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application cannot lose logs during shutting down if disk buffer was not given.</p>
            </li>
        </ul>
        <p oldrole="para"><i oldrole="emphasis">Reload:</i>
        </p>
        <ul oldrole="itemizedlist">
            <li oldrole="listitem">
                <p oldrole="para">The <MadCap:variable name="General.abbrev"></MadCap:variable> application will close the connection to database if it received SIGHUP signal (reload).</p>
            </li>
            <li oldrole="listitem">
                <p oldrole="para">It will reconnect to the database when it tries to send a new message to this database again.</p>
            </li>
        </ul>
        <h6 oldrole="formalpara">Macros:</h6>
        <p oldrole="para">The value of ${SEQNUM} macro will be overrided by sql driver regardless of local or relayed incoming message.</p>
        <p oldrole="para">It will be grown continously.</p>
		<h2>MySQL-specific interaction methods</h2>
		<p oldrole="para">To specify the socket to use, set and export the <span class="Code" oldrole="parameter">MYSQL_UNIX_PORT</span> environment variable, for example <span class="Code" oldrole="userinput">MYSQL_UNIX_PORT=/var/lib/mysql/mysql.sock; export MYSQL_UNIX_PORT</span>.</p>
		<h2>MsSQL-specific interaction methods</h2>
		<p oldrole="para">In SQL Server 2005 this restriction is lifted - kind of. The total length of all key columns in an index cannot exceed 900 bytes.</p>
		<p oldrole="para">If you are using <span class="Code" oldrole="parameter">null()</span> in your configuration, be sure that the columns allow <span class="Code" oldrole="parameter">NULL</span> to insert. Give the column as the following example: <span class="Code" oldrole="userinput">"datetime varchar(16) NULL"</span>.</p>
		<p oldrole="para">The date format used by the MSSQL database must be explicitly set in the <span class="Code" oldrole="filename">/etc/locales.conf</span> file of the syslog-ng server. <span class="Code" oldrole="userinput">[default] date = "%Y-%m-%d %H:%M:%S"</span>.</p>
    </body>
</html>