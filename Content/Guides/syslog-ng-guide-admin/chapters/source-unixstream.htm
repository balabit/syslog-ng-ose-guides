<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <meta name="description" content="" />
    </head>
    <body condition="ose" name="source-unixstream" oldrole="section">
        <h1 condition="ose" name="source-unixstream" version="5.0"><span class="Code" oldrole="parameter">unix-stream</span>, <span class="Code" oldrole="parameter">unix-dgram</span>: Collecting messages from UNIX domain sockets</h1>
        <p oldrole="para">The <span class="Code" oldrole="parameter">unix-stream()</span> and <span class="Code" oldrole="parameter">unix-dgram()</span> drivers open an <span class="Code" oldrole="parameter">AF_UNIX</span> socket and start listening on it for messages. The <span class="Code" oldrole="parameter">unix-stream()</span> driver is primarily used on Linux and uses <span class="Code" oldrole="parameter">SOCK_STREAM</span> semantics (connection oriented, no messages are lost), while <span class="Code" oldrole="parameter">unix-dgram()</span> is used on BSDs and uses <span class="Code" oldrole="parameter">SOCK_DGRAM</span> semantics: this may result in lost local messages if the system is overloaded.</p>
        <p oldrole="para">To avoid denial of service attacks when using connection-oriented protocols, the number of simultaneously accepted connections should be limited. This can be achieved using the <span class="Code" oldrole="parameter">max-connections()</span> parameter. The default value of this parameter is quite strict, you might have to increase it on a busy system.</p>
        <p oldrole="para">Both unix-stream and unix-dgram have a single required argument that specifies the filename of the socket to create. For the list of available optional parameters, see <MadCap:xref href="reference-source-unixstream.htm#reference-source-unixstream"></MadCap:xref></p>
        <h6 oldrole="formalpara">Declaration:</h6><pre class="Code" oldrole="synopsis">unix-stream(filename [options]);
unix-dgram(filename [options]);</pre>
        <table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');">
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;">
            </col>
            <col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2">
            </col>
            <tbody>
                <tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1">
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1">
                        <p>
                            <img src="../../Resources/Images/Common/note.png" />
                        </p>
                    </td>
                    <td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span>
                        <p oldrole="para"><span class="Code" oldrole="parameter">syslogd</span> on Linux originally used <span class="Code" oldrole="parameter">SOCK_STREAM</span> sockets, but some distributions switched to <span class="Code" oldrole="parameter">SOCK_DGRAM</span> around 1999 to fix a possible DoS problem. On Linux you can choose to use whichever driver you like as syslog clients automatically detect the socket type being used.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h6 name="example-source-unixstream" oldrole="example">Example: Using the unix-stream() and unix-dgram() drivers</h6><pre class="Code" oldrole="synopsis">source s_stream { unix-stream("/dev/log" max-connections(10)); };</pre><pre class="Code" oldrole="synopsis">source s_dgram { unix-dgram("/var/run/log"); };</pre>
        <!-- FIXME a correct comparison should be added, based on info from Geller Sanyi:
        unix-dgram is superiot to unix-stream:
        (it does not need 1 fd per client, does not lose messages, blocks the sender just like in stream, keeps the order of messages, and 1 read() is enough to read a complete message)
        
        <para>The difference between the unix-stream and unix-dgram drivers is similar to the
            difference between the TCP and UDP network protocols. Use the following guidelines
            to select which driver to use in a particular situation:</para>
        <para>Choose unix-stream if you would choose TCP (stream) instead of UDP (datagram). The
            unix-stream driver offers the following features:</para>
        <itemizedlist>
            <listitem>
                <para>Increased reliability</para>
            </listitem>
            <listitem>
                <para>Ordered delivery of messages</para>
            </listitem>
            <listitem>
                <para>Client-side notification of failures</para>
            </listitem>
        </itemizedlist>
        <para>Choose unix-dgram if you would choose TCP (stream) over UDP (datagram). The
            unix-dgram driver offers the following features:</para>
        <itemizedlist>
            <listitem>
                <para>Decreased possibility of Dos by opening too many connections (a local
                    vulnerability)</para>
            </listitem>
            <listitem>
                <para>Less overhead</para>
            </listitem>
        </itemizedlist>
        <para>However, the client does not notice if a message is lost when using the unix-dgram
            driver.</para>-->
    </body>
</html>