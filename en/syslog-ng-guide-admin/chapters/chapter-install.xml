<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
 [
 <!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
 %entities;]>
<chapter xml:id="chapter-install" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Installing syslog-ng</title>
    <indexterm> <primary>installing syslog-ng</primary> </indexterm>
    <para>This chapter explains how to install &product; on the supported platforms using the precompiled binary files.</para>
    <itemizedlist>
        <listitem>
            <para>The &abbrev; application features a unified installer package with identical look on every supported Linux and UNIX platforms. The generic installer, as well as installing platform-specific (for example, RPM) is described in the following sections.</para>
        </listitem>
        <listitem condition="pe6">
            <para>For details on installing FIPS-compliant &abbrev;, see <xref linkend="chapter-fips"/>.</para>
        </listitem>
        <listitem condition="pe6">
            <para>If you want to manage your &abbrev; hosts using <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://puppet.com">Puppet</link>, see <xref linkend="installing-syslog-ng-puppet"/>.</para>
        </listitem>
    </itemizedlist>
    <para>The &abbrev; binaries include all required libraries and dependencies of &abbrev;, only the <filename>ncurses</filename> library is required as an external dependency (&abbrev; itself does not use the ncurses library, it is required only during the installation). The components are installed into the <filename>/opt/syslog-ng</filename> directory. It can automatically re-use existing configuration <phrase condition="pe">and license </phrase>files, and also generate a simple configuration automatically into the <filename>/opt/syslog-ng/etc/syslog-ng.conf</filename> file.</para>
    <indexterm> <primary>syslog-ng binaries</primary> <secondary>compact</secondary> </indexterm>
    <xi:include href="../../common/wnt/note-compact-installer.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    <indexterm> <primary>syslog-ng binaries</primary> <secondary>location of</secondary> </indexterm>
    <indexterm> <primary>installation path</primary> </indexterm>
    <para>The &abbrev; application can be installed interactively following the on-screen instructions as described in <xref linkend="install-run"/>, and also without user interaction using the silent installation option &mdash; see <xref linkend="install-run-silent"/>.</para>
    <!-- FIXME leirni, melyik platformon mit csinal - regi syslog leallit, apparmor, stb. -->
    <section xml:id="install-prerequisites" condition="pe">
        <title>Prerequisites to installing &abbrev;</title>
        <indexterm> <primary>installing syslog-ng</primary> <secondary>prerequisites</secondary> </indexterm>
        <indexterm> <primary>prerequisites</primary> </indexterm>
        <itemizedlist>
            <listitem>
                <para>The binary installer packages of &product; include every required dependency for most platforms, only the <filename>ncurses</filename> library is required as an external dependency (&abbrev; itself does not use the ncurses library, it is required only during the installation).</para>
                <xi:include href="../../common/wnt/note-compact-installer.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            </listitem>
            <listitem>
                <para>For Java-based destinations (for example, Elasticsearch, Apache Kafka, HDFS), Java must be installed on the host where you use such destinations. Typically, this is the host where you are running &abbrev; in server mode.</para>
            </listitem>
            <xi:include href="../../common/chunk/listitem-nfs-do-not-install.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        </itemizedlist>
    </section>
    <section xml:id="security-enhanced-linux" condition="pe">
        <title>Security-enhanced Linux: grsecurity, &selinux;</title>
        <indexterm> <primary>Mandatory Access Control</primary> </indexterm>
        <indexterm> <primary>grsecurity</primary> </indexterm>
        <indexterm> <primary>&selinux;</primary> </indexterm>
        <para>Security-enhanced Linux solutions such as grsecurity or &selinux; can interfere with the operation of &abbrev;. The &abbrev; application supports these security enhancements as follows:</para>
        <itemizedlist>
            <listitem>
                <para><emphasis role="bold">grsecurity</emphasis>: Version &abbrev; 5 F2 and later can be run on hosts using grsecurity, with the following limitations: using the Oracle SQL source and destination is not supported.</para>
            </listitem>
            <listitem>
                <para><emphasis role="bold">&selinux;</emphasis>: Version &abbrev; 5 F2 and later properly supports &selinux; on Red Hat Enterprise Linux 6.5 and newer platforms. The CentOS platforms corresponding to the supported RHEL versions are supported as well. For details, see <xref linkend="selinux-support"/>.</para>
            </listitem>
        </itemizedlist>
    </section>
    <section xml:id="install-run">
        <title>Installing syslog-ng using the .run installer</title>
        <indexterm significance="preferred"> <primary>installing syslog-ng</primary> </indexterm>
        <xi:include href="../../common/wnt/warning-install-pid.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <para>This section describes how to install the &abbrev; application interactively using the binary installer. The installer has a simple interface: use the TAB or the arrow keys of your keyboard to navigate between the options, and Enter to select an option.</para>
        <itemizedlist>
            <listitem>
                <para>To install &abbrev; on clients or relays, complete <xref linkend="install-run-client"/>.</para>
            </listitem>
            <listitem>
                <para>To install &abbrev; on your central log server, complete <xref linkend="install-run-server"/>.</para>
            </listitem>
            <listitem>
                <para>To install &abbrev; without any user-interaction, complete <xref linkend="install-run-silent"/>.</para>
            </listitem>
        </itemizedlist>
        <note>
            <para>The installer stops the running syslogd application if it is running, but its components are not removed. The <filename>/etc/init.d/sysklogd</filename> init script is automatically renamed to <filename>/etc/init.d/sysklogd.backup</filename>. Rename this file to its original name if you want to remove syslog-ng or restart the syslogd package.</para>
        </note>
        <procedure xml:id="install-run-client">
            <title>Installing &abbrev; in client or relay mode</title>
            <indexterm> <primary>installing syslog-ng</primary> <secondary>on clients and relays</secondary> </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>Complete the following steps to install &product; on clients or relays. For details on the different operation modes of &abbrev;, see <xref linkend="concepts-modes-of-operation"/>.</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step condition="pe">
                <para>Login to your &mybalabit; account and download the &abbrev; installer package.</para>
            </step>
            <xi:include href="../../common/chunk/step-installer-welcome.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-eula.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-platform.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-alternativepath.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-register.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <step>
                <para><emphasis>Locating the license</emphasis>: Since you are installing &abbrev; in client or relay mode, simply select <guimenu>OK</guimenu>. For details on the different operation modes of &abbrev;, see <xref linkend="concepts-modes-of-operation"/>.</para>
            </step>
            <xi:include href="../../common/chunk/step-installer-upgrade.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-config.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-path.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/wnt/note-initscript-logrotate.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <step>
                <para><emphasis>Optional step for &selinux;-enabled systems</emphasis>: Complete <xref linkend="selinux-support"/>.</para>
            </step>
        </procedure>
        <procedure xml:id="install-run-server">
            <title>Installing &abbrev; in server mode</title>
            <indexterm> <primary>installing syslog-ng</primary> <secondary>on log servers</secondary> </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>Complete the following steps to install &abbrev; on log servers. For details on the different operation modes of &abbrev;, see <xref linkend="concepts-modes-of-operation"/>.</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step condition="pe">
                <para>Login to your &mybalabit; account and download the &abbrev; installer package and your &product; license file (<parameter>license.txt</parameter>). The license will be required to run &abbrev; in server mode (see <xref linkend="concepts-server-mode"/>) and is needed when you are installing &abbrev; on your central log server.</para>
            </step>
            <xi:include href="../../common/chunk/step-installer-welcome.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-eula.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-platform.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-alternativepath.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-register.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <step condition="pe">
                <para><emphasis>Locating the license</emphasis>: Enter the path to your license file (<filename>license.txt</filename>) and select <guimenu>OK</guimenu>. Typically this is required only for your central log server.</para>
                <para>If you are upgrading an existing configuration that already has a license file, the installer automatically detects it.</para>
                <figure>
                    <title>Platform detection</title>
                    <mediaobject>
                        <imageobject role="html">
                            <imagedata format="PNG" fileref="installer_license.png"/>
                        </imageobject>
                        <imageobject role="fo">
                            <imagedata format="PNG" scale="50" fileref="&imgroot;/installer_license.png"/>
                        </imageobject>
                    </mediaobject>
                </figure>
            </step>
            <xi:include href="../../common/chunk/step-installer-upgrade.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-config.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/chunk/step-installer-path.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <xi:include href="../../common/wnt/note-initscript-logrotate.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
            <step>
                <para><emphasis>Optional step for &selinux;-enabled systems</emphasis>: Complete <xref linkend="selinux-support"/>.</para>
            </step>
        </procedure>
        <section xml:id="install-run-silent">
            <title>Installing &abbrev; without user-interaction</title>
            <indexterm> <primary>installing syslog-ng</primary> <secondary>in silent mode</secondary> </indexterm>
            <para>The &abbrev; application can be installed in silent mode without any user-interaction by specifying the required parameters from the command line. Answers to every question of the installer can be set in advance using command-line parameters.</para>
            <synopsis>./syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;.run -- --silent [options]</synopsis>
            <warning>
                <para>The <command>--</command> characters between the executable and the parameters are mandatory, like in the following example: <command>./syslog-ng<phrase condition="pe">-premium-edition</phrase>-3.0.1b-solaris-10-sparc-client.run -- --silent --accept-eula -l /var/tmp/license.txt </command></para>
            </warning>
            <para>To display the list of parameters, execute the <command>./syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;.run -- --h</command> command. Currently the following options are available:</para>
            <itemizedlist>
                <listitem>
                    <para><emphasis>--accept-eula or -a</emphasis>: Accept the EULA.</para>
                </listitem>
                <listitem condition="pe">
                    <para><emphasis>--license-file &lt;file&gt; or -l &lt;file&gt;</emphasis>: Path to the license file.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--upgrade | -u</emphasis>: Perform automatic upgrade &mdash; use the configuration file from an existing installation.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--remote &lt;destination host&gt;</emphasis>: Send logs to the specified remote server. Not available when performing an upgrade.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--network</emphasis>: Accept messages from the network. Not available when performing an upgrade.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--configuration &lt;file&gt;</emphasis>: Use the specified configuration file.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--list-installed</emphasis>: List information about all installed syslog-ngs.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--path &lt;path&gt;</emphasis>: Set installation path.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--register</emphasis>: Force service registration.</para>
                </listitem>
                <listitem>
                    <para><emphasis>--no-register</emphasis>: Prevent service registration.</para>
                </listitem>
            </itemizedlist>
        </section>
    </section>
    <procedure xml:id="install-rpm">
        <title>Installing &abbrev; on RPM-based platforms (Red Hat, SUSE, AIX)</title>
        <indexterm> <primary>installing syslog-ng</primary> <secondary>from RPM package</secondary> </indexterm>
        <indexterm> <primary>installing syslog-ng</primary> <secondary>on Red Hat Enterprise Server</secondary> </indexterm>
        <indexterm> <primary>Red Hat Enterprise Server</primary> <secondary>installing syslog-ng</secondary> </indexterm>
        <indexterm> <primary>installing syslog-ng</primary> <secondary>on CentOS</secondary> </indexterm>
        <indexterm> <primary>CentOS</primary> <secondary>installing syslog-ng</secondary> </indexterm>
        <indexterm condition="pe6"> <primary>installing syslog-ng</primary> <secondary>on AIX</secondary> </indexterm>
        <indexterm condition="pe6"> <primary>AIX</primary> <secondary>installing syslog-ng</secondary> </indexterm>
        <indexterm> <primary>installing syslog-ng</primary> <secondary>on SUSE Linux Enterprise Server</secondary> </indexterm>
        <indexterm> <primary>SUSE Linux Enterprise Server</primary> <secondary>installing syslog-ng</secondary> </indexterm>
        <formalpara>
            <title>Purpose:</title>
            <para/>
        </formalpara>
        <para>To install &abbrev; on operating systems that use the Red Hat Package Manager (RPM), complete the following steps. Installing &abbrev; automatically replaces the original syslog service. The following supported operating systems use RPM:</para>
        <itemizedlist condition="pe">
            <listitem condition="pe6">
                <para>CentOS</para>
            </listitem>
            <listitem condition="pe6">
                <para>openSUSE</para>
            </listitem>
            <listitem>
                <para>Red Hat Enterprise Linux</para>
            </listitem>
            <listitem>
                <para>Red Hat Enterprise Server</para>
            </listitem>
            <listitem>
                <para>SUSE Linux Enterprise Server</para>
            </listitem>
        </itemizedlist>
        <xi:include href="../../common/wnt/warning-install-pid.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <xi:include href="../../common/wnt/warning-rhel6-python.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <formalpara>
            <title>Steps:</title>
            <para/>
        </formalpara>
        <step condition="pe">
            <para>Login to your &mybalabit; account and download the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://syslog-ng.com/downloads?product=syslog-ng-pe">syslog-ng RPM package for your system</link>.</para>
        </step>
        <step>
            <itemizedlist>
                <listitem>
                    <para>If the host already uses &abbrev; for logging, execute the following command as root. Otherwise, skip this step.</para>
                    <synopsis>rpm -U syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;arch&gt;.rpm</synopsis>
                    <para>The &product; application and all its dependencies will be installed, and the configuration of the existing &abbrev; installation will be used.</para>
                    <note>
                        <para>If you are upgrading from syslog-ng version 2.1, note that the location of the configuration file has been moved to <filename>/opt/syslog-ng/etc/syslog-ng.conf</filename></para>
                    </note>
                </listitem>
                <listitem>
                    <para>Execute the following command as root:</para>
                    <synopsis>rpm -i syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;arch&gt;.rpm</synopsis>
                    <para>The &abbrev; application and all its dependencies will be installed.</para>
                </listitem>
            </itemizedlist>
        </step>
        <step>
            <warning>
                <para>When performing an upgrade, the package manager might automatically execute the post-uninstall script of the upgraded package, stopping &abbrev; and starting syslogd. If this happens, stop syslogd and start &abbrev; by issuing the following commands:</para>
                <synopsis>/etc/init.d/syslogd stop
/etc/init.d/syslog-ng start</synopsis>
                <para>This behavior has been detected on CentOS 4 systems, but may occur on other rpm-based platforms as well.</para>
            </warning>
        </step>
        <!--<step>
                <indexterm>
                    <primary>Novell AppArmor</primary>
                </indexterm>
                <para><emphasis>Optional step</emphasis>: If Novell AppArmor is used on the
                    computer, copy the <filename>/usr/share/doc/syslog-ng/sbin.syslog-ng</filename>
                    file into the <filename>/etc/apparmor.d/</filename> directory and restart
                    AppArmor.</para>
            </step>-->
        <step>
            <para>Edit the &abbrev; configuration file as needed. If you want to run &abbrev; in server mode, copy the license file to the <filename>/opt/syslog-ng/etc/</filename> directory.</para>
            <para>For information on configuring &abbrev;, see the <xref linkend="chapter-quickstart"/>.</para>
        </step>
        <step>
            <para><emphasis>Optional step for &selinux;-enabled systems</emphasis>: Complete <xref linkend="selinux-support"/>.</para>
        </step>
        <step condition="pe6">
            <para><indexterm> <primary>AIX</primary> <secondary>redirecting errorlog to syslog-ng</secondary> </indexterm><emphasis>Optional step for AIX systems</emphasis>: To redirect the messages of the AIX Error log into syslog, create a file (for example <filename>/tmp/syslog-ng.add</filename>) with the following contents:</para>
            <synopsis>errnotify:
en_name = "syslog1"
en_persistenceflg = 1
en_method = "logger Msg from Error Log: `errpt -l $1 | grep -v 'ERROR_ID TIMESTAMP'`"</synopsis>
            <para>Then execute the following command as root: <command>odmadd /tmp/syslog-ng.add</command>.</para>
        </step>
    </procedure>
    <xi:include href="selinux-support.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
    <procedure xml:id="install-deb">
        <title>Installing syslog-ng on Debian-based platforms</title>
        <indexterm> <primary>installing syslog-ng</primary> <secondary>from DEB package</secondary> </indexterm>
        <formalpara>
            <title>Purpose:</title>
            <para/>
        </formalpara>
        <para>To install syslog-ng on operating systems that use the Debian Software Package (deb) format, complete the following steps. The following supported operating systems use this format:</para>
        <itemizedlist>
            <listitem>
                <para>Debian Wheezy</para>
            </listitem>
            <listitem>
                <para>Debian Jessie</para>
            </listitem>
            <listitem>
                <para>Ubuntu 12.04 LTS (Precise Pangolin)</para>
            </listitem>
            <listitem>
                <para>Ubuntu 14.04 LTS (Trusty Tahr)</para>
            </listitem>
            <listitem>
                <para>Ubuntu 16.04 LTS (Xenial Xerus)</para>
            </listitem>
        </itemizedlist>
        <xi:include href="../../common/wnt/warning-install-pid.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
        <formalpara>
            <title>Steps:</title>
            <para/>
        </formalpara>
        <step condition="pe">
            <para>Login to your &abbrev; account and download the <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://syslog-ng.com/downloads?product=syslog-ng-pe">&abbrev; DEB package for your system</link>.</para>
        </step>
        <!--<step>
                <para>Remove the existing system logging package from the host. Issue the following
                    command as root if the host is running syslog: <command>dpkg -r
                    sysklogd</command>, or <command>dpkg -r syslog-ng</command> if the host is
                    running the open source version of syslog-ng.</para>
            </step>-->
        <step>
            <para>Issue the following command as root:</para>
            <para><command>dpkg -i syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;arch&gt;.deb</command></para>
        </step>
        <step>
            <para>Answer the configuration questions of &abbrev;. These are described in detail in <xref linkend="install-run"/>.</para>
            <para>For information on configuring &abbrev;, see the <xref linkend="chapter-quickstart"/>.</para>
        </step>
        <!--<step>
                <indexterm>
                    <primary>Novell AppArmor</primary>
                </indexterm>
                <para><emphasis>Optional step</emphasis>: If Novell AppArmor is used on the
                    computer, copy the <filename>/usr/share/doc/syslog-ng/sbin.syslog-ng</filename>
                    file into the <filename>/etc/apparmor.d/</filename> directory and restart
                    AppArmor.</para>
            </step>-->
    </procedure>
    <section xml:id="install-pkg" condition="pe6">
        <title>Installing &abbrev; using .pkg installer</title>
        <para>The &abbrev; application can be installed with user-interaction or in silent mode.</para>
        <para>The generic syslog service of the operating system is stopped and deregistered automatically by the installer before installation.</para>
        <warning>
            <para>Remove any other syslog service before starting the installation. Failing to do so might have unpredictable results.</para>
        </warning>
        <para>The &abbrev; application is compatible with the standard Solaris logrotate mechanism by default.</para>
        <itemizedlist>
            <listitem>
                <para>To install &abbrev; with user-interaction, complete <xref linkend="install-pkg-interactive"/>.</para>
            </listitem>
            <listitem>
                <para>To install &abbrev; without any user-interaction, complete <xref linkend="install-pkg-silent"/>.</para>
            </listitem>
            <listitem>
                <para>To install &abbrev; from a transformed PKG package, complete <xref linkend="install-pkg-trans"/>.</para>
            </listitem>
        </itemizedlist>
        <procedure xml:id="install-pkg-interactive">
            <title>Installing &abbrev; with user-interaction</title>
            <indexterm> <primary>installing syslog-ng</primary> <secondary>from PKG package</secondary> </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The &abbrev; application can be installed in an interactive way.</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Unpack the package with the following command:</para>
                <synopsis>gunzip syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;architecture&gt;.pkg.gz</synopsis>
            </step>
            <step>
                <para>Run the following command:</para>
                <synopsis>pkgadd -d syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;architecture&gt;.pkg BBsyslng</synopsis>
            </step>
            <step>
                <para>Answer the questions with <userinput>y</userinput> or <userinput>n</userinput>. Besides these, the following commands are available: <userinput>?</userinput> displays the help, <userinput>q</userinput> exits the installer. The installer generates a default configuration file for &abbrev; based on the answers (if an old configuration file is not used):</para>
                <itemizedlist>
                    <listitem>
                        <para>the path of the license file</para>
                    </listitem>
                    <listitem>
                        <para>whether an old configuration file is to be used (if the answer is yes, the rest of the questions will be skipped)</para>
                    </listitem>
                    <listitem>
                        <para>if a new configuration file is requested; whether &abbrev; will send or receive logs over the network</para>
                    </listitem>
                </itemizedlist>
            </step>
            <step>
                <para>The installer finishes the installation and the replaces the default syslog service with &abbrev;.</para>
            </step>
        </procedure>
        <procedure xml:id="install-pkg-silent">
            <title>Installing &abbrev; without user-interaction</title>
            <indexterm> <primary>installing syslog-ng</primary> <secondary>from PKG package in silent mode</secondary> </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The &abbrev; application can be installed in silent mode without any user-interaction by specifying the required parameters from the command line. Answers to every question of the installer can be set in advance using command-line parameters.</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Generate a response file that contains the answers to the questions.</para>
                <synopsis>pkgask -r &lt;responsefile&gt; -d syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;architecture&gt;.pkg BBsyslng</synopsis>
                <para>For example:</para>
                <synopsis>pkgask -r response_file -d syslog-ng<phrase condition="pe">-premium-edition</phrase>-4.2.1-solaris10-amd64.pkg BBsyslng</synopsis>
                <warning>
                    <para>The <command>pkgask</command> will fail if the response file already exists.</para>
                </warning>
            </step>
            <step>
                <para>Run the <command>pkgadd</command> command with the added response file answering <userinput>y</userinput> to all questions.</para>
                <synopsis>yes | pkgadd -r &lt;responsefile&gt; -d syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;architecture&gt;.pkg BBsyslng</synopsis>
                <warning>
                    <para><command>pkgask</command> runs the request script of the package under the current condition of the operating system. The installation might fail if something changes (another &abbrev; package has been installed, configuration file has been removed), because the response file's contents will be invalid.</para>
                </warning>
            </step>
        </procedure>
        <procedure xml:id="install-pkg-trans">
            <title>Installing &abbrev; from a transformed PKG package</title>
            <indexterm> <primary>installing syslog-ng</primary> <secondary>from a transformed PKG package</secondary> </indexterm>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>The &abbrev; application can be installed from a normal file structure. To perform this, transform the .pkg package.</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>To transform the .pkg package, execute the following command:</para>
                <synopsis>pkgtrans syslog-ng<phrase condition="pe">-premium-edition</phrase>-&lt;version&gt;-&lt;OS&gt;-&lt;architecture&gt;.pkg &lt;outdirectory&gt;</synopsis>
                <para>In this case, the .pkg package will be extracted to the &lt;outdirectory&gt; directory.</para>
                <example>
                    <title>Extracting &abbrev; from a transformed PKG package</title>
                    <synopsis>pkgtrans syslog-ng-premium-edition-4.2.0-solaris-9-sparc.pkg /tmp/out</synopsis>
                    <para>This will extract the files to the <filename>/tmp/out/BBsyslng</filename> directory.</para>
                </example>
            </step>
            <step>
                <para>To install &abbrev;, execute the following command:</para>
                <synopsis>pkgadd &lt;options&gt; -d &lt;outdirectory&gt; BBsyslng</synopsis>
                <para>In this case, &lt;options&gt; stand for the <command>pkgadd</command> options, for example <command>-r &lt;responsefile&gt;</command>.</para>
            </step>
        </procedure>
    </section>
    <!--
    <xi:include href="install-puppet.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
-->
    <section xml:id="upgrading-syslog-ng" condition="pe">
        <title>Upgrading &abbrev;</title>
        <para>This section describes the possible upgrade paths of &abbrev;.</para>
        <itemizedlist>
            <listitem>
                <para>To see the possible upgrade paths, see <xref linkend="upgrading-to-pe-upgrade-path"/>.</para>
            </listitem>
            <listitem>
                <para>To upgrade an existing &abbrev; installation, see <xref linkend="procedure-upgrading-to-pe"/>.</para>
            </listitem>
        </itemizedlist>
        <section xml:id="upgrading-to-pe-upgrade-path">
            <title>Upgrading from previous &abbrev; versions to &version;</title>
            <para>Upgrading is supported from the following &abbrev; versions:</para>
            <itemizedlist>
                <listitem>
                    <para>&abbrev; 6 LTS (6.0.x)</para>
                </listitem>
            </itemizedlist>
            <para>To upgrade an existing &abbrev; installation, see <xref linkend="procedure-upgrading-to-pe"/>.</para>
        </section>
        <procedure xml:id="procedure-upgrading-to-pe">
            <title>Upgrading to &abbrev; &version;</title>
            <formalpara>
                <title>Purpose:</title>
                <para/>
            </formalpara>
            <para>To upgrade to &abbrev; &version;, complete the following steps:</para>
            <formalpara>
                <title>Steps:</title>
                <para/>
            </formalpara>
            <step>
                <para>Download the new installer package from &mybalabit;. Use the same package type as you used for the installation (for example, use the <filename>.run</filename> package for the upgrade if you have originally installed &abbrev; using a <filename>.run</filename> installer).</para>
            </step>
            <step>
                <para>Download the new license file from &mybalabit;.</para>
            </step>
            <step>
                <para>Install &abbrev; and check the warnings. Upgrade the respective parts of your configuration if needed.</para>
            </step>
            <step>
                <para>On the host where you are running &abbrev; in <link linkend="concepts-server-mode">server mode</link>, replace the old license file with the new one.</para>
                <warning>
                    <para>Hazard of data loss! Without the new license file, &abbrev; will run in relay mode, and will not store the incoming messages locally.</para>
                </warning>
            </step>
            <step>
                <para>Set the version of the configuration file to &techversion;.</para>
            </step>
        </procedure>
        <section xml:id="upgrading-pe-mixing-packages">
            <title>Upgrading &abbrev; to other package versions</title>
            <para>This scenario is not supported and will fail with the following error messages.</para>
            <simplesect>
                <title>Upgrading from platform-specific package to .run</title>
                <formalpara>
                    <title>Upgrading from rpm package to .run package</title>
                    <para/>
                </formalpara>
                <para>Unsupported. Installation stops and the following error message is displayed:</para>
                <para> <synopsis>Incompatible syslog-ng package already installed</synopsis> </para>
                <formalpara>
                    <title>Upgrading from deb package to .run package</title>
                    <para/>
                </formalpara>
                <para>Unsupported. Installation stops and the following error message is displayed:</para>
                <para> <synopsis>Incompatible syslog-ng package already installed</synopsis> </para>
                <formalpara>
                    <title>Upgrading from pkg package to .run package</title>
                    <para/>
                </formalpara>
                <para>Unsupported. Installation stops and the following error message is displayed:</para>
                <para> <synopsis>Incompatible syslog-ng package already installed to &lt;syslog-ng path&gt;</synopsis> </para>
            </simplesect>
            <simplesect>
                <title>Upgrading from .run to a platform-specific package</title>
                <para>This scenario is not supported and will fail with the following error messages. To replace a .run package with a platform-specific package, create a backup of your configuration and persist files, <link linkend="uninstalling-syslog-ng">uninstall the .run package using the <userinput>--purge</userinput> option</link>, then install the platform-specific package.</para>
                <formalpara>
                    <title>Upgrading from .run package to rpm package</title>
                    <para/>
                </formalpara>
                <para>Unsupported. Installation stops and the following error message is displayed:</para>
                <para> <synopsis>Incompatible standalone (.run) installer of &product;</synopsis> </para>
                <warning>
                    <para>Hazard of data loss! Installing rpm package &abbrev; on AIX platform is possible even if the upgrade conditions are not met, since the rpm package installs before checking the upgrade conditions and therefore no error message is displayed. This might result in overwriting the old configuration file.</para>
                </warning>
                <formalpara>
                    <title>Upgrading from .run package to deb package</title>
                    <para/>
                </formalpara>
                <para>Unsupported. Installation stops and the following error message is displayed:</para>
                <para> <synopsis>Errors were encountered while processing</synopsis> </para>
                <formalpara>
                    <title>Upgrading from .run package to pkg package</title>
                    <para/>
                </formalpara>
                <para>Unsupported. Installation stops and the following error message is displayed:</para>
                <para> <synopsis>Please remove the conflicting package before installing this package. Installation aborted.</synopsis> </para>
            </simplesect>
        </section>
        <section>
            <title>Upgrading from syslog-ng PE to syslog-ng OSE</title>
            <para>Upgrading from syslog-ng PE to syslog-ng OSE is unsupported since it counts as downgrading.</para>
        </section>
        <section xml:id="upgrading-from-ose-to-pe">
            <title>Upgrading from syslog-ng OSE to &abbrev;</title>
            <para>If you wish to upgrade your existing syslog-ng OSE installation to &abbrev;, there are a number of considerations to keep in mind. This section highlights the main differences between syslog-ng OSE and &abbrev; that are useful to know before performing an upgrade. It also provides you with step-by-step instructions on how to do the upgrade.</para>
            <formalpara>
                <title>Feature differences:</title>
                <para/>
            </formalpara>
                <para>syslog-ng OSE includes certain features that are highly experimental, require special external dependencies, or are important only to a very limited set of users. While &abbrev; is built from the same code base, it includes only a subset of syslog-ng OSE features. Those that are well tested and represent commercial value. These features are commercially supported as they are covered by automated end-to-end tests, which make sure that they not only compile but work correctly on many different platforms.</para>
                <para>This means that your syslog-ng OSE installation may contain features that are not part of &abbrev;, or if they are, they may not have been tested.</para>
            <formalpara>
                <title>Packaging:</title>
                <para/>
            </formalpara>
                <para>The packaging of syslog-ng OSE and &abbrev; also differ greatly. </para>
                <para>With syslog-ng OSE, distribution packages do not bundle dependencies and only include features for which dependencies are available within the distribution. Packaging is modular to make sure that you install only a minimal set of extra dependencies. In addition, the naming and content of subpackages varies between distributions, and there are also unofficial syslog-ng OSE packages enabling more features than available in official distribution packages.</para>
                <para>In the case of &abbrev;, all dependencies are included in a single package either in a distribution specific format (rpm or deb) or in a generic <filename>.run</filename> installer. </para>
            <procedure xml:id="syslog-ng-upgrade-ose-to-pe">
                <title>Upgrading from syslog-ng OSE to &abbrev;</title>
                <formalpara>
                    <title>Purpose:</title>
                    <para/>
                </formalpara>
                <para>The cleanest way to upgrade from syslog-ng OSE to &abbrev; is to remove the syslog-ng OSE package from the system. This way you can avoid the packaging conflicts and feature differences.</para>
                <para>In the example procedure provided here, we describe an upgrade of syslog-ng OSE version 3.12 from unofficial repositories running on Red Hat Enterprise Linux 7.4 to &abbrev; version 7.0.4. The process should work in a fairly similar way when using other OS or syslog-ng versions.</para>
                <formalpara>
                    <title>Steps:</title>
                    <para/>
                </formalpara>
                <step>
                    <para>Remove syslog-ng OSE.</para>
                    <para>The following instructions assume that the user is in the <filename>/root</filename> directory.</para>
                    <substeps>
                        <step>
                            <para>Unless you have not touched the syslog-ng configuration at all, make a backup of <filename>syslog-ng.conf</filename> first. Copy the contents of <filename>/etc/syslog-ng</filename> to a directory under <filename>/root</filename> (or where you can find it), so you have a backup you can work from later:</para>
                            <synopsis>cp -R /etc/syslog-ng sngose</synopsis>
                        </step>
                        <step>
                            <para>Remove the syslog-ng package and dependent subpackages:</para>
                            <synopsis>yum erase syslog-ng</synopsis>
                        </step>
                        <step>
                            <para>Remove the <filename>/etc/syslog-ng</filename> directory:</para>
                            <synopsis>rm -fr /etc/syslog-ng</synopsis>
                            <warning>
                                <para>Check the output of yum carefully. If there are any applications listed other than syslog-ng and subpackages, remove syslog-ng using <command>rpm -e â€”nodeps</command>, so dependent packages are not removed.</para>
                            </warning>
                        </step>
                    </substeps>
                </step>
                <step>
                    <para>Install &abbrev;.</para>
                    <para>The following instructions assume that the &abbrev; rpm package is available in the current directory. You can install &abbrev; using the following command:</para>
                    <synopsis>[root@localhost ~]# rpm -Uvh syslog-ng-premium-edition-compact-7.0.5-1.rhel7.x86_64.rpm
Preparing...                          ################################# [100%]
Trying to stop syslog services on Linux, using systemd services.
Updating / installing...
   1:syslog-ng-premium-edition-compact################################# [100%]
Created symlink from /etc/systemd/system/multi-user.target.wants/syslog-ng.service to /usr/lib/systemd/system/syslog-ng.service.
[root@localhost ~]#</synopsis>
                </step>
                <step>
                    <para>Merge configurations.</para>
                    <para>The configuration file of the freshly installed &abbrev; is available under <filename>/opt/syslog-ng/etc/syslog-ng.conf</filename>. Start by making a backup of it.</para>
                    <para>The next steps largely depend on the particulars of your previous syslog-ng OSE configuration and what you want to achieve:</para>
                    <substeps>
                        <step>
                            <para>Append your old OSE configuration to <filename>/opt/syslog-ng/etc/syslog-ng.conf</filename>.</para>
                        </step>
                        <step>
                            <para>Edit out redundant configuration parts, for example, a version declaration.</para>
                        </step>
                        <step>
                            <para>Edit out those configuration parts that refer to features unavailable in &abbrev;, such as the Riemann destination.</para>
                            <para>If you try to start &abbrev; with an unknown feature enabled, it fails with a similar error message (in the example, it is the Riemann destination that is causing the error):</para>
                            <synopsis>/opt/syslog-ng/sbin/syslog-ng -s
Error parsing destination, destination plugin riemann not found in /opt/syslog-ng/etc/syslog-ng.conf at line 41, column 2:

    riemann(
    ^^^^^^^</synopsis>
                        </step>
                        <step>
                            <para>Syntax check your configuration using the <userinput>-s</userinput> option of syslog-ng. Make sure that you use the full path to &abbrev;, or add it to the PATH:</para>
                            <synopsis>/opt/syslog-nb/sbin/syslog-ng -s</synopsis>
                        </step>
                        <step>
                            <para>If no errors are found, stop syslog-ng:</para>
                            <synopsis>systemctl stop syslog-ng</synopsis>
                        </step>
                        <step>
                            <para>Try to start syslog-ng from the command line in the foreground using the <userinput>-F</userinput> option, so you can see any errors:</para>
                            <synopsis>/opt/syslog-ng/sbin/syslog-ng -F</synopsis>
                            <para>Some common error messages and explanations:</para>
                            <itemizedlist>
                                <listitem>
                                    <para>syslog-ng OSE uses <userinput>s_sys</userinput> for references to local system sources, while &abbrev; uses <userinput>s_local</userinput>. Remember to rename such references, otherwise a similar error message will be displayed:</para>
                                    <synopsis>[2017-10-03T14:04:18.968550] Error resolving reference; content='source', name='s_sys', location='/opt/syslog-ng/etc/syslog-ng.conf:86:2'</synopsis>
                                </listitem>
                                <listitem>
                                    <para>Some features of &abbrev; require a license file to be present. In the example shown here, a Java plugin failed to initialize due to a missing license:</para>
                                    <synopsis>[2017-10-03T14:07:05.894534] syslog-ng running in client/relay mode, cannot initialize plugin; plugin name='java'
[2017-10-03T14:07:05.894560] Error initializing message pipeline; plugin name='java', location='#buffer:2:3'</synopsis>
                                </listitem>
                            </itemizedlist>
                            <para>Once you have made sure that your configuration works fine, you do not have to start syslog-ng in the foreground anymore.</para>
                        </step>
                        <step>
                            <para>Stop syslog-ng using <userinput>Ctrl-C</userinput>.</para>
                        </step>
                        <step>
                            <para>Start syslog-ng as a service using <userinput>systemctl start syslog-ng</userinput>.</para>
                        </step>
                    </substeps>
                </step>
            </procedure>
        </section>
        <section>
            <title>Upgrading from complete syslog-ng PE to client setup version of syslog-ng PE</title>
            <para>The installer displays the following message if you try to upgrade from complete syslog-ng PE to client setup syslog-ng PE with .run package.</para>
            <para> <synopsis>This version of syslog-ng Premium Edition doesn't support storing messages in SQL servers, while the installed one did.</synopsis> </para>
        </section>
    </section>
    <xi:include href="uninstalling-syslog-ng.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
        <xi:fallback>FIXME XINCLUDE ERROR</xi:fallback>
    </xi:include>
    <xi:include href="configuring-mssql-server.xml" xmlns:xi="http://www.w3.org/2001/XInclude">
        <xi:fallback>FIXME XINCLUDE ERROR</xi:fallback>
    </xi:include>
</chapter>
