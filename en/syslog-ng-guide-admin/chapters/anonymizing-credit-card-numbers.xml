<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section
 [  <!ENTITY % entities SYSTEM "../../common/syslog-ng-entities.ent">
 %entities;]>
<section xml:id="anonymizing-credit-card-numbers" condition="ose" xmlns="http://docbook.org/ns/docbook" version="5.0">
    <title>Anonymizing credit card numbers</title>
    <indexterm>
        <primary>anonymizing credit card numbers</primary>
    </indexterm>
    <indexterm>
        <primary>credit card numbers</primary>
        <secondary>masking</secondary>
    </indexterm>
    <indexterm>
        <primary>credit card numbers</primary>
        <secondary>anonymizing</secondary>
    </indexterm>
    <indexterm>
        <primary>data anonymization</primary>
    </indexterm>
    <para>Log messages of banking and e-commerce applications might include credit card numbers (Primary Account Number or PAN). According to privacy best practices and the requirements of the Payment Card Industry Data Security Standards (PCI-DSS), PAN must be rendered unreadable. The &abbrev; application uses a regular expression to detect credit card numbers, and provides two ways to accomplish this: you can either mask the credit card numbers, or replace them with a hash. To mask the credit card numbers, use the <parameter>credit-card-mask()</parameter> or the <parameter>credit-card-hash()</parameter> rewrite rules in a log path.</para>
    <formalpara>
        <title>Usage:</title>
        <para/>
    </formalpara>
    <synopsis>@include "scl/rewrite/cc-mask.conf"

rewrite { credit-card-mask(value("&lt;message-field-to-process&gt;")); };</synopsis>
    <para>By default, these rewrite rules process the MESSAGE part of the log message.</para>
    <simplesect xml:id="credit-card-hash">
        <title>credit-card-hash()</title>
        <indexterm type="parameter">
            <primary>credit-card-hash</primary>
        </indexterm>
        <informaltable frame="topbot" colsep="0" rowsep="0">
            <tgroup cols="2">
                <colspec colnum="1" colwidth="50pt"/>
                <tbody>
                    <row>
                        <entry>Synopsis:
							<?dbhtml bgcolor="#D4D6EB" ?>
<?dbfo bgcolor="#D4D6EB" ?>
                        </entry>
                        <entry>credit-card-hash(value("&lt;message-field-to-process&gt;"))</entry>
                    </row>
                </tbody>
            </tgroup>
        </informaltable>
        <para><emphasis role="bold">Description:</emphasis> Process the specified message field (by default, <userinput>${MESSAGE}</userinput>), and replace any credit card numbers (Primary Account Number or PAN) with its 16-character-long SHA-1 hash.</para>
    </simplesect>
    <simplesect xml:id="credit-card-mask">
        <title>credit-card-mask()</title>
        <indexterm type="parameter">
            <primary>credit-card-mask</primary>
        </indexterm>
        <informaltable frame="topbot" colsep="0" rowsep="0">
            <tgroup cols="2">
                <colspec colnum="1" colwidth="50pt"/>
                <tbody>
                    <row>
                        <entry>Synopsis:
							<?dbhtml bgcolor="#D4D6EB" ?>
<?dbfo bgcolor="#D4D6EB" ?>
                        </entry>
                        <entry>credit-card-mask(value("&lt;message-field-to-process&gt;"))</entry>
                    </row>
                </tbody>
            </tgroup>
        </informaltable>
        <para><emphasis role="bold">Description:</emphasis> Process the specified message field (by default, <userinput>${MESSAGE}</userinput>), and replace the 7-12th character of any credit card numbers (Primary Account Number or PAN) with asterisks (<userinput>*</userinput>). For example, &abbrev; replaces the number <userinput>5542043004559005</userinput> with <userinput>554204******9005</userinput>.</para>
    </simplesect>
</section>
