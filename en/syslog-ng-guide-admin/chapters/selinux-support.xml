<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE procedure
 [  <!ENTITY % entities SYSTEM "../../shared/syslog-ng-entities.ent">
 %entities;]>
<procedure xml:id="selinux-support" xmlns="http://docbook.org/ns/docbook" version="5.0" condition="pe">
    <title>Using &abbrev; on &selinux;</title>
    <indexterm> <primary>&selinux;</primary> </indexterm>
    <formalpara>
        <title>Purpose:</title>
        <para/>
    </formalpara>
    <para>Version &abbrev; 5 F2 and later properly supports &selinux; on Red Hat Enterprise Linux 6.5 and newer platforms. Version 5 F5 and later also supports &selinux; on Red Hat Enterprise Linux 5, as well as on 6.0-6.4. The CentOS and Oracle Linux platforms corresponding to the supported RHEL versions are supported as well. To use &abbrev; on a &selinux;-enabled host, complete the following steps.</para>
    <note>
        <para>The following steps install &selinux; policy module that enables &abbrev; to properly run with its default configuration and default installation path (<filename>/opt/syslog-ng</filename>) on a &selinux;-enabled host. If you configure &abbrev; to perform an operation that is outside the permissions of this policy module (for example, to bind to a non-standard port, use a program destination or source, or to write logfiles in a non-standard directory), you have to modify and recompile the policy module. If you need help with that, contact the BalaBit Support Team.</para>
    </note>
    <formalpara>
        <title>Prerequisites:</title>
        <para/>
    </formalpara>
    <itemizedlist>
        <listitem>
            <para>The following packages must be available on the host: <filename>policycoreutils</filename>,<filename>policycoreutils-devel</filename>, <filename>policycoreutils-python</filename>. If they are not already installed, issue the following command: <command>yum install policycoreutils policycoreutils-devel policycoreutils-python</command></para>
        </listitem>
        <listitem>
            <para>On RHEL 6.5, update the following packages at least to the indicated versions. These packages are available in the Red Hat repositories and are installed by default on RHEL 6.6. You can update them with the <command>yum update selinux-policy</command> command.</para>
            <itemizedlist>
                <listitem>
                    <para><filename>selinux-policy-3.7.19-231.el6.noarch > 3.7.19-260.el6.noarch</filename></para>
                </listitem>
                <listitem>
                    <para><filename>selinux-policy-targeted-3.7.19-231.el6.noarch > 3.7.19-260.el6.noarch</filename></para>
                </listitem>
            </itemizedlist>
        </listitem>
        <listitem>
            <para>The &abbrev; application must be installed on the host. For details, see <xref linkend="chapter-install"/>.</para>
        </listitem>
    </itemizedlist>
    <formalpara>
        <title>Steps:</title>
        <para/>
    </formalpara>
    <step>
        <para>Download the &abbrev; &selinux; policy module from <link xmlns:ns1="http://www.w3.org/1999/xlink" ns1:href="https://my.balabit.com/downloads/syslog-ng/syslog-ng-pe-5F2_and_higher-SELinux">https://my.balabit.com/downloads/syslog-ng/syslog-ng-pe-5F2_and_higher-SELinux</link></para>
    </step>
    <step>
        <para>Uncompress the file and run the <command>./syslog_ng.sh</command> script to compile and load the &selinux; rules for &abbrev;.</para>
    </step>
    <step>
        <para>Restart &abbrev; using the following command.</para>
        <warning>
            <para>The &selinux; policy works only if &abbrev; is started by the init daemon.</para>
        </warning>
        <itemizedlist>
            <listitem>
                <para>On RHEL6: <command>service syslog-ng restart</command></para>
            </listitem>
            <listitem>
                <para>On RHEL7: <command>systemctl restart syslog-ng</command></para>
            </listitem>
        </itemizedlist>
        <para>If you do not use the <command>service</command> or the <command>systemctl</command> to start &abbrev; execute the <filename>syslog_ng.sh</filename> script again after starting &abbrev;. This is required to correct the settings of the files related to &abbrev; (most notably <filename>/dev/log</filename> and the files under <filename>/opt/syslog-ng</filename>). The settings can become incorrect if the privileges of the process that started &abbrev; are different from the privileges of the <command>service</command> or the <command>systemctl</command> process.</para>
    </step>
    <step>
        <para>(Optional): The &abbrev; application can create coredumps, but this is disabled by default. You can enable coredumps with the <command>setsebool -P daemons_dump_core 1</command> command.</para>
        <para>Note that his command enables every daemons on your system to create core dumps, not just &abbrev;. There is no way to enable per-application core dumps in &selinux;.</para>
    </step>
    <formalpara>
        <title>Expected result:</title>
        <para/>
    </formalpara>
    <para>The &abbrev; application is installed and properly running under SELinux. If &abbrev; does not start, or displays permission errors, execute the <command>syslog_ng.sh</command>.</para>
</procedure>
